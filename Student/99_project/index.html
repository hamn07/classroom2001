<!DOCTYPE html>
<html>

<head>
    <title></title>
    <!-- load jQuery -->
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <!-- load lightbox -->
    <!-- css of this page -->
    <style type="text/css">
    #wrapper {
        margin: 0 auto;
    }
    
    nav {
        box-shadow: 0 5px 6px #d8d9db;
        border: 1px solid #d8d9db;
        background-color: #fff;
        height: 120px;
        /*width: 960px;*/
        /*margin-left: -10px;*/
        /*line-height: 50px;*/
        
        position: relative;
        z-index: 1;
    }
    
    .filter {
        padding: 2px;
        background-color: #000000;
        opacity: 0.7;
        /*float: right;*/
        
        color: #fff;
        font-size: 12px;
        position: absolute;
        right: 0px;
        top: 120px;
    }
    
    #content {
        background: #fff;
        height: 1500px;
        /* presetting the height */
        
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
    }
    
    .fixed {
        position: fixed;
        left: 0;
        right: 0;
    }
    
    .zitem {
        width: 200px;
        height: 200px;
        border: 4px solid #222;
        margin: 5px 5px 5px 0;
        /* required to hide the image after resized */
        
        overflow: hidden;
        /* for child absolute position */
        
        position: relative;
        /* display div in line */
        
        float: left;
    }
    
    .zitem .caption {
        width: 125px;
        height: 30px;
        background: #000;
        color: #fff;
        font-weight: bold;
        /* fix it at the bottom */
        
        position: absolute;
        bottom: -1px;
        /* fix IE issue */
        
        left: 0;
        /* hide it by default */
        
        display: none;
        /* opacity setting */
        
        filter: alpha(opacity=70);
        /* ie  */
        
        -moz-opacity: 0.7;
        /* old mozilla browser like netscape  */
        
        -khtml-opacity: 0.7;
        /* for really really old safari */
        
        opacity: 0.7;
        /* css standard, currently it works in most modern browsers like firefox,  */
    }
    
    .zitem .caption a:first-child {
        text-decoration: none;
        color: #fff;
        font-size: 12px;
        /* add spacing and make the whole row clickable*/
        
        padding: 5px;
        display: inline-block;
    }
    /*    img {
        border: 0;
         allow javascript moves the img position
        
        position: absolute;
    }*/
    
    .clear {
        clear: both;
    }
    
    .enlarge {
        display: none;
        width: 100%;
        /*height: 200px;*/
        
        border: 4px solid #222;
        margin: 5px 5px 5px 0;
        /* required to hide the image after resized */
        
        overflow: hidden;
        /* for child absolute position */
        
        position: relative;
        /* display div in line */
        
        float: left;
    }
    </style>
    <!-- *************** -->
    <!-- js of this page -->
    <!-- *************** -->
    <script type="text/javascript">
    // in order to regex filename from url of an image
    String.prototype.filename = function(extension) {
        var s = this.replace(/\\/g, '/');
        s = s.substring(s.lastIndexOf('/') + 1);
        return extension ? s.replace(/[?#].+$/, '') : s.split('.')[0];
    }
    var imgCount = 0;
    $(document).ready(function() {

        //Calculate the height of <header>
        //Use outerHeight() instead of height() if have padding
        var aboveHeight = $('nav').outerHeight();

        // when scroll
        $(window).scroll(function() {

            //if scrolled down more than the header's height
            if ($(window).scrollTop() > aboveHeight) {

                // if yes, add "fixed" class to the <nav>
                // add padding top to the #content (value is same as the height of the nav)
                $('nav').addClass('fixed').css('top', '0').next().css('padding-top', '60px');
            } else {

                // when scroll up or less than aboveHeight, remove the "fixed" class, and the padding-top
                $('nav').removeClass('fixed').next().css('padding-top', '0');
            }
        });

        $("#urlSelect").click(function(e) {
            var imgUrl = prompt("Please enter image url:", "http://");
            if (imgUrl != null) {
                myFuncRenderImage(imgUrl, imgUrl.filename(), false);
            }
        })

        $("#fileSelect").click(function(e) {
            if ($("#fileElem")) {
                $("#fileElem").click();
            }
            e.preventDefault();

        });
        $("#fileElem").change(function(e) {
            // 檔案(array)
            var fileList = this.files;
            // 檔案個數
            var numFiles = fileList.length;
            for (var i = 0; i < numFiles; i++) {
                // 取得檔案物件
                var file = fileList[i];
                // 轉換成local url
                var objectURL = window.URL.createObjectURL(file);

                myFuncRenderImage(objectURL, file.name, true);
            }
        })

        $("#filterPopup").click(function() {
            if ($("#filter").css("display") == "none") {
                $("#filter").css("display", "block");
                $("#searchText").focus();
            } else {
                $("#filter").css("display", "none");

            }
        });
        $("#searchText").keypress(function(e) {
            searchTextValue = this.value.toLowerCase();
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            if (keyCode == '13') {
                // Enter pressed
                var zitemList = document.getElementsByClassName("zitem");
                console.log(zitemList.length);
                for (var i = 0; i < zitemList.length; i++) {
                    var zitem = zitemList[i];
                    var descText = $(zitem).children(".caption").children("a").html().toLowerCase();
                    if (descText.indexOf(searchTextValue) == -1) {
                        zitem.style.display = "none";
                        // console.log("not found --> "+descText);
                    } else {
                        zitem.style.display = "block";
                        // console.log("found --> "+descText);
                    }
                }
            }

        });
    });
    // url: 圖片位址
    // isLocal: 是否為local image upload
    function myFuncRenderImage(url, fileName, isLocal) {
        imgCount++;
        // 建立enlarge div物件，並將img物件餵給它
        var enlargeDiv = document.createElement("div");
        enlargeDiv.id = "img" + imgCount + "-enlarge";
        enlargeDiv.className = "enlarge";
        document.body.appendChild(enlargeDiv);
        var enlargeImg = document.createElement("img");
        enlargeImg.src = url;
        enlargeImg.width = $(window).width();
        enlargeDiv.onclick = function() {

            this.style.display = "none";
            window.scrollTo(0, 0);
        }
        enlargeDiv.appendChild(enlargeImg);


        // 建立div物件，並將img物件餵給它
        var div = document.createElement("div");
        div.className = "zitem";
        // document.body.insertBefore(div, document.body.firstChild);
        $("#content").prepend(div);


        // 建立img物件，並將src設定為local url
        var a = document.createElement("a");
        a.id = "img" + imgCount;
        //show enlarge imgae
        a.onclick = function() {
            // hide previous enlarge image first
            $(".enlarge").css("display", "none");
            var elemImage = document.getElementById(this.id + "-enlarge");
            // elemImage.style.width = $(window).width();
            elemImage.style.display = "inline";
            $("#content").prepend(elemImage);
        };
        a.href = "#";
        var img = document.createElement("img");
        img.src = url;
        img.width = $('.zitem').width();
        img.height = $('.zitem').height();
        img.onload = function() {
            window.URL.revokeObjectURL(this.src);
        };

        // 建立a href物件，並將img物件餵給它
        // var a = document.createElement("a");
        // a.href = objectURL;
        a.appendChild(img);


        div.appendChild(a);

        // 建立caption
        a = document.createElement("a");
        a.href = "#";
        a.innerHTML = fileName;
        a.onclick = function() {
            var modifiedDesc = prompt("Modify Description:", this.innerHTML);
            if (modifiedDesc != null) {
                this.innerHTML = modifiedDesc;
            }
        }
        var caption = document.createElement("div");
        $(caption).addClass("caption");
        $(caption).width($('.zitem').width());
        caption.appendChild(a);

        // delete icon
        var deleteIconHref = document.createElement("a");
        deleteIconHref.href = "#";
        deleteIconHref.style.right = "1px";
        deleteIconHref.style.cssFloat = "right";
        var deleteIcon = document.createElement("img");
        deleteIcon.src = "img/Cancel-24.png";
        deleteIcon.onclick = function() {
            $(this).parent("a").parent().parent(".zitem").remove();
        };

        deleteIconHref.appendChild(deleteIcon);
        caption.appendChild(deleteIconHref);
        div.appendChild(caption);


        //move the image in pixel
        var move = -15;

        //zoom percentage, 1.2 =120%
        var zoom = 1.2;

        //On mouse over those thumbnail
        $('.zitem').hover(function() {

                //Set the width and height according to the zoom percentage
                width = $('.zitem').width() * zoom;
                height = $('.zitem').height() * zoom;

                //Move and zoom the image
                $(this).find('.zitem.a.img').stop(false, true).animate({
                    'width': width,
                    'height': height,
                    'top': move,
                    'left': move
                }, {
                    duration: 200
                });

                //Display the caption
                $(this).find('div.caption').stop(false, true).fadeIn(200);
            },
            function() {
                //Reset the image
                $(this).find('.zitem.a.img').stop(false, true).animate({
                    'width': $('.zitem').width(),
                    'height': $('.zitem').height(),
                    'top': '0',
                    'left': '0'
                }, {
                    duration: 100
                });

                //Hide the caption
                $(this).find('div.caption').stop(false, true).fadeOut(200);
            });
    }
    document.onkeyup = function(e){
        if (!e) e = window.event;
        var keyCode = e.keyCode || e.which;
        if (keyCode==27){
            $("#filter").css("display","none");
            $(".enlarge").css("display", "none");
            window.scrollTo(0, 0);
        }
    }
    </script>
</head>

<body>
    <div id="wrapper">
        <nav>
            <a href="#" id="fileSelect"><img src="img/Folder-Add-01-128.png" class="icon"></a>
            <input type="file" id="fileElem" multiple accept="image/*" style="display:none">
            <a href="#" id="urlSelect"><img src="img/Add-Earth-128.png"></a>
            <a href="#"><img src="img/Media-Play-02-128.png"></a>
            <a href="#" id="filterPopup" style=""><img src="img/Filtering-128.png"></a>
            <div id="filter" style="display:none;" class="filter">
                <lable for="searchText">Search:</lable>
                <input type="search" id="searchText">
            </div>
        </nav>
        <!--         <div id="enlargeContent">
        </div> -->
        <div id="content"></div>
    </div>
</body>

</html>
